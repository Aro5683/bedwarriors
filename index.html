<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>PDF Viewer App</title>
  <style>
    body { font-family: Arial; background:#f6f7fb; }
    .container { width: 600px; margin: 40px auto; background:white; padding:20px; border-radius:10px; box-shadow:0 4px 10px rgba(0,0,0,0.1); text-align:center; }
    input, button { width:100%; padding:10px; margin:8px 0; border-radius:6px; }
    input { border:1px solid #ddd; }
    button { border:none; background:#2563eb; color:white; font-weight:600; cursor:pointer; }
    #popup, #loginMsg { display:none; justify-content:center; align-items:center; margin-top:20px; padding:12px; background:#dcfce7; border:1px solid #16a34a; border-radius:6px; color:#166534; text-align:center;}
    .device-box { margin-top:12px; font-size:14px; color:#555; }
    #languageSelection button { width:45%; margin:10px; }
    .image-item { margin:20px 0; cursor:pointer; }
    .image-item img { max-width:250px; border-radius:6px; }
    #pdfContainer { width:100%; height:600px; display:none; margin-top:20px; }
    #pdfViewer { width:100%; height:100%; border:none; }
  </style>
</head>
<body>

<!-- Registration -->
<div class="container" id="submitContainer">
  <h2>Sign Up (New User Only)</h2>
  <form id="paymentForm">
    <input type="text" name="name" placeholder="Your Name" required>
    <input type="email" name="email" placeholder="Your Email" required>
    <input type="password" name="password" placeholder="Your Password" required>
    <input type="hidden" name="deviceId" id="deviceId">
    <button type="submit">Sign Up</button>
  </form>
  <button id="showLoginBtn" style="background:#10b981;">Login</button>
  <div id="popup">Please wait for Admin Approval.</div>
  <div class="device-box" id="deviceBox"></div>
</div>

<!-- Login -->
<div class="container" id="loginContainer" style="display:none;">
  <h2>Login</h2>
  <form id="loginForm">
    <input type="email" id="loginEmail" placeholder="Email" required>
    <input type="password" id="loginPassword" placeholder="Password" required>
    <button type="submit">Login</button>
  </form>
  <div id="loginMsg"></div>
  <div class="device-box" id="loginDeviceBox"></div>
</div>

<!-- Language Selection -->
<div class="container" id="languageSelection" style="display:none;">
  <h2>Select Medium</h2>
  <button id="englishBtn">English Medium</button>
  <button id="tamilBtn">Tamil Medium</button>
</div>

<!-- Images Section -->
<div class="container" id="imageSection" style="display:none;">
  <div id="imagesContainer"></div>
</div>

<!-- PDF Viewer -->
<div class="container" id="pdfContainer">
  <iframe id="pdfViewer"></iframe>
</div>

<script>
  // Generate UUID for device
  function uuidv4() {
    return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
      var r = Math.random() * 16 | 0, v = c=='x'?r:(r&0x3|0x8); return v.toString(16);
    });
  }

  let deviceId = localStorage.getItem("deviceId");
  if(!deviceId){
    deviceId = uuidv4();
    localStorage.setItem("deviceId", deviceId);
  }
  document.getElementById("deviceId").value = deviceId;
  document.getElementById("deviceBox").textContent = "Your Device ID: " + deviceId;
  document.getElementById("loginDeviceBox").textContent = "Your Device ID: " + deviceId;

  const submitContainer = document.getElementById('submitContainer');
  const loginContainer = document.getElementById('loginContainer');
  const popup = document.getElementById('popup');
  const loginMsg = document.getElementById('loginMsg');
  const languageSelection = document.getElementById('languageSelection');
  const imageSection = document.getElementById('imageSection');
  const imagesContainer = document.getElementById('imagesContainer');
  const pdfContainer = document.getElementById('pdfContainer');
  const pdfViewer = document.getElementById('pdfViewer');

  // ===== Users =====
  const users = [
    {name:"Alice Smith", email:"alice@example.com", password:"alice123", deviceId:"43648fb2-330b-4d0a-b7f0-aa469228c4bf"},
    {name:"Bob Johnson", email:"bob@example.com", password:"bob123", deviceId:"123e4567-e89b-12d3-a456-426614174001"}
  ];

  document.getElementById('showLoginBtn').addEventListener('click', ()=>{
    submitContainer.style.display='none';
    loginContainer.style.display='block';
  });

  const form = document.getElementById('paymentForm');
  form.addEventListener('submit', e=>{
    e.preventDefault();
    const name = form.name.value;
    const email = form.email.value.trim();
    const password = form.password.value;

    if(users.find(u=>u.email===email)){
      alert("Email already registered.");
      return;
    }

    users.push({name,email,password,deviceId});
    popup.style.display='flex';
    form.reset();
    setTimeout(()=>{
      popup.style.display='none';
      submitContainer.style.display='none';
      loginContainer.style.display='block';
      loginMsg.textContent="Registration successful. Please login.";
      loginMsg.style.color='green';
      loginMsg.style.display='flex';
    },500);
  });

  const loginForm = document.getElementById('loginForm');
  loginForm.addEventListener('submit', e=>{
    e.preventDefault();
    const email = document.getElementById('loginEmail').value.trim();
    const password = document.getElementById('loginPassword').value;

    const user = users.find(u=>u.email===email && u.password===password);
    if(!user){
      loginMsg.textContent="Invalid email or password.";
      loginMsg.style.color='red';
      loginMsg.style.display='flex';
      return;
    }

    if(user.deviceId!==deviceId){
      loginMsg.textContent="This account is registered on another device.";
      loginMsg.style.color='red';
      loginMsg.style.display='flex';
      return;
    }

    loginMsg.textContent="Login successful!";
    loginMsg.style.color='green';
    loginMsg.style.display='flex';
    loginContainer.style.display='none';
    languageSelection.style.display='block';
  });

  // ===== JSON Data for Images / PDFs =====
  const filesJSON = {
    english: [
      {img:'images/english1.jpg', title:'Book 1', author:'Author A', pdf:'english1.pdf'},
      {img:'images/english2.jpg', title:'Book 2', author:'Author B', pdf:'pdfs/english2.pdf'},
      {img:'images/english3.jpg', title:'Book 3', author:'Author C', pdf:'pdfs/english3.pdf'},
      {img:'images/english4.jpg', title:'Book 4', author:'Author D', pdf:'pdfs/english4.pdf'}
    ],
    tamil: [
      {img:'images/tamil1.jpg', title:'Book 1', author:'Author X', pdf:'pdfs/tamil1.pdf'},
      {img:'images/tamil2.jpg', title:'Book 2', author:'Author Y', pdf:'pdfs/tamil2.pdf'},
      {img:'images/tamil3.jpg', title:'Book 3', author:'Author Z', pdf:'pdfs/tamil3.pdf'},
      {img:'images/tamil4.jpg', title:'Book 4', author:'Author W', pdf:'pdfs/tamil4.pdf'}
    ]
  };

  function showFiles(files){
    imagesContainer.innerHTML='';
    pdfContainer.style.display='none';

    files.forEach(file=>{
      const div=document.createElement('div');
      div.className='image-item';
      div.innerHTML=`<img src="${file.img}" loading="lazy" alt="${file.title}">
                     <h3>${file.title}</h3><p>${file.author}</p>`;
      div.addEventListener('click', ()=>{
        // Open PDF.js locally
        const viewerUrl = `pdfjs/web/viewer.html?file=${encodeURIComponent(file.pdf)}#disableprint=true&disabledownload=true&toolbar=0`;
        pdfViewer.src = viewerUrl;
        pdfContainer.style.display='block';
        window.scrollTo({top: pdfViewer.offsetTop, behavior:'smooth'});
      });
      imagesContainer.appendChild(div);
    });
    imageSection.style.display='block';
  }

  document.getElementById('englishBtn').addEventListener('click', ()=>showFiles(filesJSON.english));
  document.getElementById('tamilBtn').addEventListener('click', ()=>showFiles(filesJSON.tamil));
</script>
</body>
</html>
